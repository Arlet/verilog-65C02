/*
 * ALU operation:
 * ========================
 * 00---   pass
 * 01---   M
 * 10---   left
 * 11---   right
 * ========================
 * --000   R | M      OR 
 * --001   R & M      AND
 * --010   R ^ M      EOR
 * --011   R + M      ADC
 * --100   R + 0      R or INC depending on CI
 * --101   R - 1      R or DEC depending on CI
 * --110   R - M      SBC/CMP
 * --111  ~R & M      TRB
 *
 */

/*
 *                          next[2:0]       
 * us                       carry out      ci 
 * ---------                -------        --
 * 00   SYNC                000 keep       00 = 0
 * 01   NEXT                001 0          01 = 1
 * 11   SAVE + NEXT         010 1          10 = C 
 * 10   LOAD                011 ALU         
 *                          1xx PLP
 *                            
 */

// opcode dispatcher
// 
// do = data output
// W  = write enable
// ab = address bus control
// us = flow control (see above)
// dst = destination register
// src = source register
// aluop = ALU operation (see above)
// ci = carry input select (see above)
// next = address of next microinstruction (or flags when SYNC)
// 
//      -----------------------------------+---------+
//               when used as flag control:|VDIN&ZCCC|
//      -----------------------------------+---------+
//             do W_ab_ us dst src aluop ci|  next   |
//      ------+--+-----+--+---+---+-----+--+---------+
//            |  |     |  |   |   |     |  |         |
@000    000000_00_11011_01_011_011_00101_00_0001_1000     // BRK        -> @118
@001    000000_00_00001_11_100_000_01101_00_0000_1101     // ORA (ZP,X) -> @10D
@005    000000_00_00001_11_100_111_01101_00_0000_0000     // ORA ZP     -> @100
@006    000000_00_00001_11_100_111_01100_00_0000_0010     // ASL ZP     -> @102 -> @18C
@008    000000_00_10100_01_011_011_00101_00_0001_0110     // PHP        -> @116
@009    000000_00_00000_01_100_000_00000_00_1000_1101     // ORA IMM    -> @18D
@00A    000000_00_00000_00_010_010_10100_00_0000_0011     // ASL A 
@00D    000000_00_00000_11_100_000_01101_00_0000_0001     // ORA ABS    -> @101
@00E    000000_00_00000_11_100_111_01100_00_0000_0100     // ASL ABS    -> @104 -> @18C
@010    000000_00_01001_01_100_000_00000_00_0000_0011     // BPL        -> @103
@011    000000_00_00001_11_100_111_01101_00_0000_1111     // ORA (ZP),Y -> @10F
@012    000000_00_00001_11_100_111_01101_00_0000_1101     // ORA (ZP)   -> @10D
@015    000000_00_00001_11_100_000_01101_00_0000_0000     // ORA ZP,X   -> @100
@016    000000_00_00001_11_100_000_01100_00_0000_0010     // ASL ZP,X   -> @102 -> @18C
@018    000000_00_00000_00_100_000_00000_00_0000_0011     // CLC 
@019    000000_00_00000_11_100_000_01101_00_0001_0010     // ORA ABS,Y  -> @112
@01A    000000_00_00000_00_010_010_00100_01_0001_1000     // INA
@01D    000000_00_00000_11_100_000_01101_00_0001_0001     // ORA ABS,X  -> @111
@01E    000000_00_00000_11_100_111_01100_00_0000_0101     // ASL ABS,X  -> @105 -> @18C
@020    000000_00_11011_01_011_011_00101_00_0000_1001     // JSR        -> @109
@021    000000_00_00001_11_100_000_01011_00_0000_1101     // AND (ZP,X) -> @10D
@024    000000_00_00001_11_100_111_01010_00_0000_0000     // BIT ZP     -> @100
@025    000000_00_00001_11_100_111_01011_00_0000_0000     // AND ZP     -> @100
@026    000000_00_00001_11_100_111_11001_00_0000_0010     // ROL ZP     -> @102 -> @192
@028    000000_00_00111_01_011_011_00100_01_0001_0100     // PLP        -> @114
@029    000000_00_00000_01_100_000_00000_00_1000_1011     // AND IMM    -> @180
@02A    000000_00_00000_00_010_010_10100_10_0000_0011     // ROL A 
@02C    000000_00_00000_11_100_111_01010_00_0000_0001     // BIT ABS    -> @101
@02D    000000_00_00000_11_100_000_01011_00_0000_0001     // AND ABS    -> @101
@02E    000000_00_00000_11_100_111_11001_00_0000_0100     // ROL ABS    -> @104 -> @192
@030    000000_00_01000_01_100_000_00000_00_0000_0011     // BMI        -> @103
@031    000000_00_00001_11_100_111_01011_00_0000_1111     // AND (ZP),Y -> @10F
@032    000000_00_00001_11_100_111_01011_00_0000_1101     // AND (ZP)   -> @10D
@035    000000_00_00001_11_100_000_01011_00_0000_0000     // AND ZP,X   -> @100
@036    000000_00_00001_11_100_000_11001_00_0000_0010     // ROL ZP,X   -> @102 -> @192
@038    000000_00_00000_00_100_111_00101_01_0000_0011     // SEC 
@039    000000_00_00000_11_100_000_01011_00_0001_0010     // AND ABS,Y  -> @112
@03A    000000_00_00000_00_010_010_00101_01_0001_1000     // DEA
@03D    000000_00_00000_11_100_000_01011_00_0001_0001     // AND ABS,X  -> @111
@03E    000000_00_00000_11_100_111_11001_00_0000_0101     // ROL ABS,X  -> @105 -> @192
@040    000000_00_00111_01_011_011_00100_01_0001_1100     // RTI        -> @11C
@041    000000_00_00001_11_100_000_01001_00_0000_1101     // EOR (ZP,X) -> @10D
@045    000000_00_00001_11_100_111_01001_00_0000_0000     // EOR ZP     -> @100
@046    000000_00_00001_11_100_111_11001_00_0000_0010     // LSR ZP     -> @102 -> @193
@048    000000_00_10100_01_011_011_00101_00_1000_0110     // PHA        -> @186
@049    000000_00_00000_01_100_000_00000_00_1000_1001     // EOR IMM    -> @189
@04A    000000_00_00000_00_010_010_11100_00_0000_0011     // LSR A 
@04C    000000_00_00000_01_100_000_00000_00_0000_0110     // JMP ABS    -> @106
@04D    000000_00_00000_11_100_000_01001_00_0000_0001     // EOR ABS    -> @101
@04E    000000_00_00000_11_100_111_11001_00_0000_0100     // LSR ABS    -> @104 -> @193
@050    000000_00_01001_01_100_000_00000_00_0000_0011     // BVC        -> @103
@051    000000_00_00001_11_100_111_01001_00_0000_1111     // EOR (ZP),Y -> @10F
@052    000000_00_00001_11_100_111_01001_00_0000_1101     // EOR (ZP)   -> @10D
@055    000000_00_00001_11_100_000_01001_00_0000_0000     // EOR ZP,X   -> @100
@056    000000_00_00001_11_100_000_11001_00_0000_0010     // LSR ZP,X   -> @102 -> @193
@058    000000_00_00000_00_100_000_00000_00_0010_0000     // CLI 
@059    000000_00_00000_11_100_000_01001_00_0001_0010     // EOR ABS,Y  -> @112
@05A    000000_00_10100_01_011_011_00101_00_1000_1000     // PHY        -> @188
@05D    000000_00_00000_11_100_000_01001_00_0001_0001     // EOR ABS,X  -> @111
@05E    000000_00_00000_11_100_111_11001_00_0000_0101     // LSR ABS,X  -> @105 -> @193
@060    000000_00_00111_01_011_011_00100_01_0000_1011     // RTS        -> @10B
@061    000000_00_00001_11_100_000_00011_00_0000_1101     // ADC (ZP,X) -> @10D
@065    000000_00_00001_11_100_111_00011_00_0000_0000     // ADC ZP     -> @100
@066    000000_00_00001_11_100_111_11001_00_0000_0010     // ROR ZP     -> @102 -> @194
@068    000000_00_00111_01_011_011_00100_01_0000_0111     // PLA        -> @107
@069    000000_00_00000_01_100_000_00000_00_1000_0011     // ADC IMM    -> @180
@06A    000000_00_00000_00_010_010_11100_10_0000_0011     // ROR A 
@06C    000000_00_00000_01_100_000_00011_00_0010_0111     // JMP (ABS)  -> @127
@06D    000000_00_00000_11_100_000_00011_00_0000_0001     // ADC ABS    -> @101
@06E    000000_00_00000_11_100_111_11001_00_0000_0100     // ROR ABS    -> @104 -> @194
@070    000000_00_01000_01_100_000_00000_00_0000_0011     // BVS        -> @103
@071    000000_00_00001_11_100_111_00011_00_0000_1111     // ADC (ZP),Y -> @10F
@072    000000_00_00001_11_100_111_00011_00_0000_1101     // ADC (ZP)   -> @10D
@075    000000_00_00001_11_100_000_00011_00_0000_0000     // ADC ZP,X   -> @100
@076    000000_00_00001_11_100_000_11001_00_0000_0010     // ROR ZP,X   -> @102 -> @194
@078    000000_00_00000_00_100_000_00000_00_0010_0000     // SEI 
@079    000000_00_00000_11_100_000_00011_00_0001_0010     // ADC ABS,Y  -> @112
@07A    000000_00_00111_01_011_011_00100_01_0001_0011     // PLY        -> @113
@07D    000000_00_00000_11_100_000_00011_00_0001_0001     // ADC ABS,X  -> @111
@07E    000000_00_00000_11_100_111_11001_00_0000_0101     // ROR ABS,X  -> @105 -> @194
@080    000000_00_01101_01_100_000_00000_00_0000_0011     // BRA        -> @103
@081    000000_00_00001_11_100_000_00110_00_0010_0011     // STA (ZP,X) -> @123 -> @186
@084    000000_00_10001_01_100_111_00000_00_1000_1000     // STY ZP     -> @188
@085    000000_00_10001_01_100_111_00000_00_1000_0110     // STA ZP     -> @186
@086    000000_00_10001_01_100_111_00000_00_1000_0111     // STX ZP     -> @187
@088    000000_00_00000_00_001_001_00101_00_0001_1000     // DEY 
@08A    000000_00_00000_00_010_000_00100_00_0001_1000     // TXA 
@08C    000000_00_00000_11_100_111_01000_00_0010_0000     // STY ABS    -> @120 -> @188
@08D    000000_00_00000_11_100_111_00110_00_0010_0000     // STA ABS    -> @120 -> @186
@08E    000000_00_00000_11_100_111_00111_00_0010_0000     // STX ABS    -> @120 -> @187
@090    000000_00_01001_01_100_000_00000_00_0000_0011     // BCC        -> @103
@091    000000_00_00001_11_100_111_00110_00_0010_0101     // STA (ZP),Y -> @125 -> @186
@092    000000_00_00001_11_100_111_00110_00_0010_0011     // STA (ZP)   -> @123 -> @186
@094    000000_00_10001_01_100_000_00000_00_1000_1000     // STY ZP,X   -> @188
@095    000000_00_10001_01_100_000_00000_00_1000_0110     // STA ZP,X   -> @186
@096    000000_00_10001_01_100_001_00000_00_1000_0111     // STX ZP,Y   -> @187
@098    000000_00_00000_00_010_001_00100_00_0001_1000     // TYA
@099    000000_00_00000_11_100_111_00110_00_0010_0010     // STA ABS,Y  -> @122 -> @186
@09A    000000_00_00000_00_011_000_00100_00_0000_0000     // TXS 
@09D    000000_00_00000_11_100_111_00110_00_0010_0001     // STA ABS,X  -> @121 -> @186
@0A0    000000_00_00000_01_100_000_00000_00_1000_0010     // LDY IMM    -> @182
@0A1    000000_00_00001_11_100_000_00000_00_0000_1101     // LDA (ZP,X) -> @10D
@0A2    000000_00_00000_01_100_000_00000_00_1000_0001     // LDX IMM    -> @181
@0A4    000000_00_00001_11_100_111_00010_00_0000_0000     // LDY ZP     -> @100 -> @182
@0A5    000000_00_00001_11_100_111_00000_00_0000_0000     // LDA ZP     -> @100
@0A6    000000_00_00001_11_100_111_00001_00_0000_0000     // LDX ZP     -> @100 -> @181
@0A8    000000_00_00000_00_001_010_00100_00_0001_1000     // TAY
@0A9    000000_00_00000_01_100_000_00000_00_1000_0000     // LDA IMM    -> @180
@0AA    000000_00_00000_00_000_010_00100_00_0001_1000     // TAX
@0AC    000000_00_00000_11_100_000_00010_00_0000_0001     // LDA ABS    -> @101 -> @182
@0AD    000000_00_00000_11_100_000_00000_00_0000_0001     // LDY ABS    -> @101
@0AE    000000_00_00000_11_100_000_00001_00_0000_0001     // LDX ABS    -> @101
@0B0    000000_00_01000_01_100_000_00000_00_0000_0011     // BCS        -> @103
@0B1    000000_00_00001_11_100_111_00000_00_0000_1111     // LDA (ZP),Y -> @10F
@0B2    000000_00_00001_11_100_111_00000_00_0000_1101     // LDA (ZP)   -> @10D
@0B4    000000_00_00001_11_100_000_00010_00_0000_0000     // LDY ZP,X   -> @100 -> @182
@0B5    000000_00_00001_11_100_000_00000_00_0000_0000     // LDA ZP,X   -> @100
@0B6    000000_00_00001_11_100_001_00001_00_0000_0000     // LDX ZP,Y   -> @100 -> @181
@0B8    000000_00_00000_00_100_111_00011_00_1000_0000     // CLV 
@0B9    000000_00_00000_11_100_000_00000_00_0001_0010     // LDA ABS,Y  -> @112 -> @180
@0BA    000000_00_00000_00_000_011_00100_00_0001_1000     // TSX
@0BC    000000_00_00000_11_100_000_00010_00_0001_0001     // LDY ABS,X  -> @111
@0BD    000000_00_00000_11_100_000_00000_00_0001_0001     // LDA ABS,X  -> @111
@0BE    000000_00_00000_11_100_000_00001_00_0001_0010     // LDX ABS,Y  -> @112 -> @181
@0C0    000000_00_00000_01_100_000_00000_00_1001_0001     // CPY IMM    -> @191
@0C1    000000_00_00001_11_100_000_01110_00_0000_1101     // CMP (ZP,X) -> @10D
@0C4    000000_00_00001_11_100_111_10001_00_0000_0000     // CPY ZP     -> @100 -> @191
@0C5    000000_00_00001_11_100_111_01110_00_0000_0000     // CMP ZP     -> @100
@0C6    000000_00_00001_11_100_111_00101_00_0000_0010     // DEC ZP     -> @102
@0C8    000000_00_00000_00_001_001_00100_01_0001_1000     // INY
@0C9    000000_00_00000_01_100_000_00000_00_1000_1110     // CMP IMM    -> @18E
@0CA    000000_00_00000_00_000_000_00101_00_0001_1000     // DEX 
@0CC    000000_00_00000_11_100_111_10001_00_0000_0001     // CPY ABS    -> @100 -> @191
@0CD    000000_00_00000_11_100_000_01110_00_0000_0001     // CMP ABS    -> @101
@0CE    000000_00_00000_11_100_111_00101_00_0000_0100     // DEC ABS    -> @104 -> @185
@0D0    000000_00_01001_01_100_000_00000_00_0000_0011     // BNE        -> @103
@0D1    000000_00_00001_11_100_111_01110_00_0000_1111     // CMP (ZP),Y -> @10F
@0D2    000000_00_00001_11_100_111_01110_00_0000_1101     // CMP (ZP)   -> @10D
@0D5    000000_00_00001_11_100_000_01110_00_0000_0000     // CMP ZP,X   -> @100
@0D6    000000_00_00001_11_100_000_00101_00_0000_0010     // DEC ZP,X   -> @102
@0D8    000000_00_00000_00_100_000_00000_00_0100_0000     // CLD
@0D9    000000_00_00000_11_100_000_01110_00_0001_0010     // CMP ABS,Y  -> @112
@0DA    000000_00_10100_01_011_011_00101_00_1000_0111     // PHX        -> @187
@0DD    000000_00_00000_11_100_000_01110_00_0001_0001     // CMP ABS,X  -> @111
@0DE    000000_00_00000_11_100_111_00101_00_0000_0101     // DEC ABS,X  -> @105 -> @185
@0E0    000000_00_00000_01_100_000_00000_00_1001_0000     // CPX IMM    -> @190
@0E1    000000_00_00001_11_100_000_01111_00_0000_1101     // SBC (ZP,X) -> @10D
@0E4    000000_00_00001_11_100_111_10000_00_0000_0000     // CPX ZP     -> @100 -> @190
@0E5    000000_00_00001_11_100_111_01111_00_0000_0000     // SBC ZP     -> @100
@0E6    000000_00_00001_11_100_111_00100_00_0000_0010     // INC ZP     -> @102
@0E8    000000_00_00000_00_000_000_00100_01_0001_1000     // INX
@0E9    000000_00_00000_01_100_000_00000_00_1000_1111     // SBC IMM    -> @18F
@0EA    000000_00_00000_00_100_000_00000_00_0000_0000     // NOP
@0EC    000000_00_00000_11_100_111_10000_00_0000_0001     // CPX ABS    -> @100 -> @190
@0ED    000000_00_00000_11_100_000_01111_00_0000_0001     // SBC ABS    -> @101
@0EE    000000_00_00000_11_100_111_00100_00_0000_0100     // INC ABS    -> @104
@0F0    000000_00_01000_01_100_000_00000_00_0000_0011     // BEQ        -> @103
@0F1    000000_00_00001_11_100_111_01111_00_0000_1111     // SBC (ZP),Y -> @10F
@0F2    000000_00_00001_11_100_111_01111_00_0000_1101     // SBC (ZP)   -> @10D
@0F5    000000_00_00001_11_100_000_01111_00_0000_0000     // SBC ZP,X   -> @100
@0F6    000000_00_00001_11_100_000_00100_00_0000_0010     // INC ZP,X   -> @102
@0F8    000000_00_00000_00_100_000_00000_00_0100_0000     // SED 
@0F9    000000_00_00000_11_100_000_01111_00_0001_0010     // SBC ABS,Y  -> @112
@0FA    000000_00_00111_01_011_011_00100_01_0000_1000     // PLX        -> @108
@0FD    000000_00_00000_11_100_000_01111_00_0001_0001     // SBC ABS,X  -> @111
@0FE    000000_00_00000_11_100_111_00100_00_0000_0101     // INC ABS,X  -> @105 -> @184

// preppers
@100    000000_00_00010_10_100_000_00000_00_0000_0000     // DATA       -> FIN
@101    000000_00_00011_01_100_111_00000_00_0000_0000     // ABS        -> @100
@102    000000_00_10101_10_100_000_00000_00_0000_0000     // RMW
@103    000000_00_00000_00_100_000_00000_00_0000_0000     // NOP
@104    000000_00_00011_01_100_111_00000_00_0000_0010     // ABS RMW    -> @100
@105    000000_00_00011_01_100_000_00000_00_0000_0010     // ABS,X RMW  -> @100
@106    000000_00_00011_01_100_111_00000_00_0000_0011     // JMP ABS    -> @103
@107    000000_00_00010_01_100_000_00000_00_1000_0000     // PLA        -> @180
@108    000000_00_00010_01_100_000_00000_00_1000_0001     // PLX        -> @181
@109    000000_11_11010_01_011_011_00101_00_0000_1010     // JSR        -> @10A
@10A    000000_10_00010_01_100_000_00000_00_0000_0110     // JSR        -> @10A
@10B    000000_00_00111_01_011_011_00100_01_0000_1100     // RTS        -> @10C
@10C    000000_00_00011_01_100_101_00000_00_0000_0011     // RTS        -> @103
@10D    000000_00_00000_01_100_000_00000_00_0000_1110     // (ZP)       -> @10E
@10E    000000_00_00110_01_100_111_00000_00_0000_0000     // (ZP)       -> @100
@10F    000000_00_00000_01_100_000_00000_00_0001_0000     // (ZP),Y     -> @110
@110    000000_00_00110_01_100_001_00000_00_0000_0000     // (ZP),Y     -> @100
@111    000000_00_00011_01_100_000_00000_00_0000_0000     // ABS,X      -> @100
@112    000000_00_00011_01_100_001_00000_00_0000_0000     // ABS,Y      -> @100
@113    000000_00_00010_01_100_000_00000_00_1000_0010     // PLY        -> @182
@114    000000_00_00010_01_100_000_00000_00_0001_0101     // PLP        -> @115
@115    000000_00_00000_00_100_000_00000_00_0000_0100     // PLP
@116    000000_01_00010_01_100_000_00000_00_0000_0011     // PHP        -> @103
@117    000000_00_00000_00_100_000_01000_00_0001_1000     // RMW with NZ 
@118    000000_11_11010_01_011_011_00101_00_0001_1001     // BRK        -> @119
@119    000000_10_11010_01_011_011_00101_00_0001_1010     // BRK        -> @11A
@11A    000000_01_01100_01_100_100_00000_00_0001_1011     // BRK        -> @11B
@11B    000000_00_00000_01_100_000_00000_00_0010_1000     // BRK        -> @128
@11C    000000_00_00111_01_011_011_00100_01_0001_1101     // RTI        -> @11D
@11D    000000_01_00111_01_011_011_00100_01_0001_1110     // RTI        -> @11E
@11E    000000_01_00011_01_100_111_00000_00_0001_0101     // RTI        -> @115
@11F    000000_00_00000_00_100_000_00000_00_0001_1001     // NOP with NZC (using delayed carry)
@120    000000_00_10011_10_100_111_00000_00_0000_0000     // STA ABS    -> FIN
@121    000000_00_10011_10_100_000_00000_00_0000_0000     // STA ABS,X  -> FIN 
@122    000000_00_10011_10_100_001_00000_00_0000_0000     // STA ABS,Y  -> FIN 
@123    000000_00_00000_01_100_000_00000_00_0010_0100     // (ZP)       -> @124
@124    000000_00_10110_10_100_111_00000_00_0000_0000     // (ZP)       -> FIN 
@125    000000_00_00000_01_100_000_00000_00_0010_0110     // (ZP),Y     -> @126
@126    000000_00_10110_10_100_001_00000_00_0000_0000     // (ZP),Y     -> FIN 
@127    000000_00_00011_01_100_111_00000_00_0001_1011     // JMP (IND)  -> @11B
@128    000000_00_00011_01_100_111_00000_00_0010_1001     // BRK JMP    -> @129
@129    000000_00_00000_00_100_000_00000_00_0110_0000     // BRK JMP

// finishers
@180    000000_00_00000_00_010_000_01000_00_0001_1000     // LDA, SYNC
@181    000000_00_00000_00_000_000_01000_00_0001_1000     // LDX, SYNC
@182    000000_00_00000_00_001_000_01000_00_0001_1000     // LDY, SYNC
@183    000000_00_00000_00_010_010_00011_11_1001_1011     // ADC, SYNC
@184    000000_00_00010_01_100_101_00011_00_0001_0111     // INC, NZ    -> @117
@185    000000_00_00010_01_100_110_00011_00_0001_0111     // DEC, NZ    -> @117
@186    000000_00_00010_01_100_010_00100_00_0000_0011     // STA, NOP   -> @103
@187    000000_00_00010_01_100_000_00100_00_0000_0011     // STX, NOP   -> @103
@188    000000_00_00010_01_100_001_00100_00_0000_0011     // STY, NOP   -> @103
@189    000000_00_00000_00_010_010_00010_00_0001_1000     // EOR, SYNC 
@18A    000000_00_00000_00_100_010_00001_00_1000_1000     // BIT, SYNC
@18B    000000_00_00000_00_010_010_00001_00_0001_1000     // AND, SYNC
@18C    000000_00_00010_01_100_111_10011_00_0001_1111     // ASL, NZC   -> @11F
@18D    000000_00_00000_00_010_010_00000_00_0001_1000     // ORA, SYNC 
@18E    000000_00_00000_00_100_010_00110_01_0001_1011     // CMP, SYNC 
@18F    000000_00_00000_00_010_010_00110_11_1001_1011     // SBC, SYNC 
@190    000000_00_00000_00_100_000_00110_01_0001_1011     // CPX, SYNC 
@191    000000_00_00000_00_100_001_00110_01_0001_1011     // CPY, SYNC 
@192    000000_00_00010_01_100_111_10011_11_0001_1111     // ROL, NZC   -> @11F
@193    000000_00_00010_01_100_111_10011_11_0001_1111     // LSR, NZC   -> @11F
@194    000000_00_00010_01_100_111_10011_11_0001_1111     // ROR, NZC   -> @11F

